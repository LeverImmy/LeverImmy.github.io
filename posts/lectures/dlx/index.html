


<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <link rel="canonical" href="https://leverimmy.top/posts/lectures/dlx/">
      
      
      <link rel="shortcut icon" href="../../../assets/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.3">
    
    
      
        <title>Dancing Links - Clever_Jimmy's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.947af8d5.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://leverimmy.top/" title="Clever_Jimmy's Blog" class="md-header-nav__button md-logo" aria-label="Clever_Jimmy's Blog">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Clever_Jimmy's Blog
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Dancing Links
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../.." class="md-tabs__link">
          首页
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../editorials/" class="md-tabs__link">
          题解
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" class="md-tabs__link md-tabs__link--active">
          学习笔记
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../articles/" class="md-tabs__link">
          杂笔
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../mood/" class="md-tabs__link">
          说说
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../whk/" class="md-tabs__link">
          文化课
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../about/intro/" class="md-tabs__link">
          关于
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://leverimmy.top/" title="Clever_Jimmy's Blog" class="md-nav__button md-logo" aria-label="Clever_Jimmy's Blog">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Clever_Jimmy's Blog
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      首页
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="首页" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        首页
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../.." title="" class="md-nav__link">
      
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../articles/how-to-build-this-fucking-blog/" title="如何使用 MkDocs 建立一个博客" class="md-nav__link">
      如何使用 MkDocs 建立一个博客
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Dancing Links
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Dancing Links" class="md-nav__link md-nav__link--active">
      Dancing Links
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    精确覆盖问题
  </a>
  
    <nav class="md-nav" aria-label="精确覆盖问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    定义
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    问题转化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    暴力 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    暴力 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#x" class="md-nav__link">
    X 算法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dancing-links-x" class="md-nav__link">
    Dancing Links 优化的 X 算法
  </a>
  
    <nav class="md-nav" aria-label="Dancing Links 优化的 X 算法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    预编译命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    ****定义****
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove" class="md-nav__link">
    remove 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover" class="md-nav__link">
    recover 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    build 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    insert 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dance" class="md-nav__link">
    dance 操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    模板
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    时间复杂度分析
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    如何建模
  </a>
  
    <nav class="md-nav" aria-label="如何建模">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    **例题一 数独 **
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    **例题二 靶形数独 **
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noi2005" class="md-nav__link">
    **例题三 「NOI2005」智慧珠游戏 **
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    练习
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    总结
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    参考资料
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kmp/" title="前缀函数与 KMP 算法" class="md-nav__link">
      前缀函数与 KMP 算法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      题解
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="题解" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        题解
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../editorials/" title="概览" class="md-nav__link">
      概览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      AtCoder
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="AtCoder" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        AtCoder
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../editorials/atcoder/ABC171F/" title="ABC171F" class="md-nav__link">
      ABC171F
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../editorials/atcoder/ABC172E/" title="ABC172E" class="md-nav__link">
      ABC172E
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../editorials/bzoj/" title="BZOJ" class="md-nav__link">
      BZOJ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      CodeForces
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="CodeForces" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        CodeForces
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../editorials/codeforces/CF1393D/" title="CF1393D" class="md-nav__link">
      CF1393D
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../editorials/luogu/" title="洛谷" class="md-nav__link">
      洛谷
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      POJ
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="POJ" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        POJ
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../editorials/poj/1961/" title="1961 - Period" class="md-nav__link">
      1961 - Period
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      学习笔记
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="学习笔记" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        学习笔记
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="概览" class="md-nav__link">
      概览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ac-automaton/" title="AC 自动机" class="md-nav__link">
      AC 自动机
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Dancing Links
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Dancing Links" class="md-nav__link md-nav__link--active">
      Dancing Links
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    精确覆盖问题
  </a>
  
    <nav class="md-nav" aria-label="精确覆盖问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    定义
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    问题转化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    暴力 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    暴力 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#x" class="md-nav__link">
    X 算法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dancing-links-x" class="md-nav__link">
    Dancing Links 优化的 X 算法
  </a>
  
    <nav class="md-nav" aria-label="Dancing Links 优化的 X 算法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    预编译命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    ****定义****
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove" class="md-nav__link">
    remove 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover" class="md-nav__link">
    recover 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    build 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    insert 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dance" class="md-nav__link">
    dance 操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    模板
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    时间复杂度分析
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    如何建模
  </a>
  
    <nav class="md-nav" aria-label="如何建模">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    **例题一 数独 **
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    **例题二 靶形数独 **
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noi2005" class="md-nav__link">
    **例题三 「NOI2005」智慧珠游戏 **
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    练习
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    总结
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    参考资料
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pam/" title="回文树" class="md-nav__link">
      回文树
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../easy-dynamic-programming/" title="经典动态规划模型" class="md-nav__link">
      经典动态规划模型
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../karatsuba/" title="Karatsuba 乘法" class="md-nav__link">
      Karatsuba 乘法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sim-euclid/" title="类欧几里得算法" class="md-nav__link">
      类欧几里得算法
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lyndon/" title="Lyndon 分解" class="md-nav__link">
      Lyndon 分解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kmp/" title="前缀函数与 KMP 算法" class="md-nav__link">
      前缀函数与 KMP 算法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      杂笔
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="杂笔" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        杂笔
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../articles/" title="概览" class="md-nav__link">
      概览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../articles/latex-search/" title="LaTeX 语法索引" class="md-nav__link">
      LaTeX 语法索引
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../articles/how-to-build-this-fucking-blog/" title="如何使用 MkDocs 建立一个博客" class="md-nav__link">
      如何使用 MkDocs 建立一个博客
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      说说
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="说说" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        说说
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mood/" title="概览" class="md-nav__link">
      概览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mood/2020-08/" title="2020.08" class="md-nav__link">
      2020.08
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mood/2020-09/" title="2020.09" class="md-nav__link">
      2020.09
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      文化课
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="文化课" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        文化课
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../whk/" title="概览" class="md-nav__link">
      概览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      数学
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="数学" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        数学
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../whk/maths/sum-of-a-geometric-array/" title="等比数列求和公式" class="md-nav__link">
      等比数列求和公式
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../whk/maths/immovable-point-of-an-array/" title="数列不动点浅探" class="md-nav__link">
      数列不动点浅探
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      关于
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="关于" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        关于
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/intro/" title="关于我" class="md-nav__link">
      关于我
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/friends/" title="友情链接" class="md-nav__link">
      友情链接
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    精确覆盖问题
  </a>
  
    <nav class="md-nav" aria-label="精确覆盖问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    定义
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    问题转化
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    暴力 1
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    暴力 2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#x" class="md-nav__link">
    X 算法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dancing-links-x" class="md-nav__link">
    Dancing Links 优化的 X 算法
  </a>
  
    <nav class="md-nav" aria-label="Dancing Links 优化的 X 算法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    预编译命令
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    ****定义****
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove" class="md-nav__link">
    remove 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recover" class="md-nav__link">
    recover 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    build 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    insert 操作
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dance" class="md-nav__link">
    dance 操作
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    模板
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    时间复杂度分析
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    如何建模
  </a>
  
    <nav class="md-nav" aria-label="如何建模">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    **例题一 数独 **
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    **例题二 靶形数独 **
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noi2005" class="md-nav__link">
    **例题三 「NOI2005」智慧珠游戏 **
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    练习
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    总结
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    参考资料
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>Dancing Links</h1>
                
                <p>懒得维护 OI-Wiki 上的 dlx 了（其实是不会 git），于是就有了这篇博文。</p>
<h2 id="_1"><strong>精确覆盖问题</strong><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="_2"><strong>定义</strong><a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>精确覆盖问题 (Exact Cover Problem) 是指给定许多集合 <span class="arithmatex">\(S_i (1 \le i \le n)\)</span> 以及一个集合 <span class="arithmatex">\(X\)</span> ，求满足以下条件的无序多元组 <span class="arithmatex">\((T_1, T_2, \cdots , T_m)\)</span> ：</p>
<ol>
<li><span class="arithmatex">\(\forall i, j \in [1, m],T_i\bigcap T_j = \varnothing (i \neq j)\)</span> </li>
<li><span class="arithmatex">\(X = \bigcup\limits_{i = 1}^{m}T_i\)</span> </li>
<li><span class="arithmatex">\(\forall i \in[1, m], T_i \in \\{S_1, S_2, \cdots, S_n\\}\)</span> </li>
</ol>
<div class="admonition example">
<p class="admonition-title">一个「精确覆盖问题」的例子</p>
<p>给出
$$
\begin{aligned}
  &amp; S_1 = \{5, 9, 17\} \\
  &amp; S_2 = \{1, 8, 119\} \\
  &amp; S_3 = \{3, 5, 17\} \\
  &amp; S_4 = \{1, 8\} \\
  &amp; S_5 = \{3, 119\} \\
  &amp; S_6 = \{8, 9, 119\} \\
  &amp; X = \{1, 3, 5, 8, 9, 17, 119\}
\end{aligned}
$$
则 <span class="arithmatex">\((S_1, S_4, S_5)\)</span> 为一组合法解。</p>
</div>
<h3 id="_3"><strong>问题转化</strong><a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>我们将 <span class="arithmatex">\(\bigcup\limits_{i = 1}^{n}S_i\)</span> 中的所有数离散化，那么可以得到这么一个模型：</p>
<blockquote>
<p>给定一个 01 矩阵，你可以选择一些行，使得最终每列都恰好有一个 1。</p>
</blockquote>
<p>举个例子，我们对上文中的例子进行建模，可以得到这么一个矩阵：
$$
\begin{pmatrix}
  0 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 1 &amp; 0 \\
  1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 \\
  0 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
  1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
  0 &amp; 0 &amp; 0 &amp; 1 &amp; 1 &amp; 0 &amp; 1
\end{pmatrix}
$$
其中第 <span class="arithmatex">\(i\)</span> 行表示着 <span class="arithmatex">\(S_i\)</span> ，而这行的每个数依次表示 <span class="arithmatex">\([1 \in S_i],[3 \in S_i],[5 \in S_i],\cdots,[119 \in S_i]\)</span> 。</p>
<h3 id="1"><strong>暴力 1</strong><a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>我们可以枚举选择哪些行，最后检查这个方案是否合法。</p>
<p>因为每一行都有选或者不选两种状态，所以枚举行的时间复杂度是 <span class="arithmatex">\(O(2^n)\)</span> 的；</p>
<p>而每次检查都需要 <span class="arithmatex">\(O(nm)\)</span> 的时间复杂度。所以总的复杂度是 <span class="arithmatex">\(O(nm\cdot2^n)\)</span>。</p>
<details class="note"><summary>代码实现</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="n">ok</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">state</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// 枚举每行是否被选</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">state</span><span class="p">)</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bo</span><span class="p">)</span>
          <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">else</span>
          <span class="n">bo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">)</span>
    <span class="k">continue</span><span class="p">;</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">state</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">)</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;No solution.&quot;</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>

</details>
<h3 id="2"><strong>暴力 2</strong><a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p>考虑到 01 矩阵的特殊性质，我们可以把每一行都看做成一个 <span class="arithmatex">\(m\)</span> 位二进制数。</p>
<p>因此被转化为了</p>
<blockquote>
<p>给你 <span class="arithmatex">\(n\)</span> 个 <span class="arithmatex">\(m\)</span> 位二进制数，要求选择一些数，使得任意两个数的与都为 0，且所有数的或为 <span class="arithmatex">\(2^m - 1\)</span> 。</p>
<p><code>tmp</code> 表示的是截至目前的所有被选择了的 <span class="arithmatex">\(m\)</span> 位二进制数的或。</p>
</blockquote>
<p>因为每一行都有选或者不选两种状态，所以枚举行的时间复杂度为 <span class="arithmatex">\(O(2^n)\)</span> ；</p>
<p>而每次计算 <code>tmp</code> 都需要 <span class="arithmatex">\(O(n)\)</span> 的时间复杂度。所以总的复杂度为 <span class="arithmatex">\(O(n\cdot2^n)\)</span> 。</p>
<details class="note"><summary>代码实现</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="n">ok</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="o">--</span><span class="n">j</span><span class="p">)</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">state</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">tmp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">break</span><span class="p">;</span>
      <span class="n">tmp</span> <span class="o">|=</span> <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">m</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">state</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">)</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;No solution.&quot;</span><span class="p">);</span>
</code></pre></div>
</td></tr></table>

</details>
<h2 id="x"><strong>X 算法</strong><a class="headerlink" href="#x" title="Permanent link">&para;</a></h2>
<p>Donald E. Knuth 提出了 X 算法 (Algorithm X)，其思想与刚才的暴力差不多，但是方便优化。</p>
<p>继续以上文中中提到的例子为载体，我们得到的是一个这样的 01 矩阵：
$$
\begin{pmatrix}
  0 &amp; 0 &amp; 1 &amp; 0 &amp; 1 &amp; 1 &amp; 0 \\
  1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 1 \\
  0 &amp; 1 &amp; 1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 \\
  1 &amp; 0 &amp; 0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 \\
  0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 1 \\
  0 &amp; 0 &amp; 0 &amp; 1 &amp; 1 &amp; 0 &amp; 1
\end{pmatrix}
$$
1.  此时第一行有 <span class="arithmatex">\(3\)</span> 个 <span class="arithmatex">\(1\)</span> ，第二行有 <span class="arithmatex">\(3\)</span> 个 <span class="arithmatex">\(1\)</span> ，第三行有 <span class="arithmatex">\(3\)</span> 个 <span class="arithmatex">\(1\)</span> ，第四行有 <span class="arithmatex">\(2\)</span> 个 <span class="arithmatex">\(1\)</span> ，第五行有 <span class="arithmatex">\(2\)</span> 个 <span class="arithmatex">\(1\)</span> ，第六行有 <span class="arithmatex">\(3\)</span> 个 <span class="arithmatex">\(1\)</span> 。选择第一行，将它删除，并将所有 <span class="arithmatex">\(1\)</span> 所在的列打上标记；
    $$
    \begin{pmatrix}
      \color{Blue}0 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}1 &amp; \color{Blue}0 \\
      1 &amp; 0 &amp; \color{Red}0 &amp; 1 &amp; \color{Red}0 &amp; \color{Red}0 &amp; 1 \\
      0 &amp; 1 &amp; \color{Red}1 &amp; 0 &amp; \color{Red}0 &amp; \color{Red}1 &amp; 0 \\
      1 &amp; 0 &amp; \color{Red}0 &amp; 1 &amp; \color{Red}0 &amp; \color{Red}0 &amp; 0 \\
      0 &amp; 1 &amp; \color{Red}0 &amp; 0 &amp; \color{Red}0 &amp; \color{Red}0 &amp; 1 \\
      0 &amp; 0 &amp; \color{Red}0 &amp; 1 &amp; \color{Red}1 &amp; \color{Red}0 &amp; 1
      \end{pmatrix}
    $$
2.  选择所有被标记的列，将它们删除，并将这些列中含 <span class="arithmatex">\(1\)</span> 的行打上标记；
    $$
    \begin{pmatrix}
      \color{Blue}0 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}1 &amp; \color{Blue}0 \\
      1 &amp; 0 &amp; \color{Blue}0 &amp; 1 &amp; \color{Blue}0 &amp; \color{Blue}0 &amp; 1 \\
      \color{Red}0 &amp; \color{Red}1 &amp; \color{Blue}1 &amp; \color{Red}0 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Red}0 \\
      1 &amp; 0 &amp; \color{Blue}0 &amp; 1 &amp; \color{Blue}0 &amp; \color{Blue}0 &amp; 0 \\
      0 &amp; 1 &amp; \color{Blue}0 &amp; 0 &amp; \color{Blue}0 &amp; \color{Blue}0 &amp; 1 \\
      \color{Red}0 &amp; \color{Red}0 &amp; \color{Blue}0 &amp; \color{Red}1 &amp; \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Red}1
    \end{pmatrix}
    $$
3.  选择所有被标记的行，将它们删除；
    $$
    \begin{pmatrix}
      \color{Blue}0 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}1 &amp; \color{Blue}0 \\
      1 &amp; 0 &amp; \color{Blue}0 &amp; 1 &amp; \color{Blue}0 &amp; \color{Blue}0 &amp; 1 \\
      \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}0 \\
      1 &amp; 0 &amp; \color{Blue}0 &amp; 1 &amp; \color{Blue}0 &amp; \color{Blue}0 &amp; 0 \\
      0 &amp; 1 &amp; \color{Blue}0 &amp; 0 &amp; \color{Blue}0 &amp; \color{Blue}0 &amp; 1 \\
      \color{Blue}0 &amp; \color{Blue}0 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1
    \end{pmatrix}
    $$
    <strong>这表示表示我们选择了一行，且这一行的所有 <span class="arithmatex">\(1\)</span> 所在的列不能有其他 <span class="arithmatex">\(1\)</span> 了。</strong>
    于是我们得到了这样的一个新的小 01 矩阵：
    $$
    \begin{pmatrix}
      1 &amp; 0 &amp; 1 &amp; 1 \\
      1 &amp; 0 &amp; 1 &amp; 0 \\
      0 &amp; 1 &amp; 0 &amp; 1
    \end{pmatrix}
    $$
4.  此时第一行（原来的第二行）有 <span class="arithmatex">\(3\)</span> 个 <span class="arithmatex">\(1\)</span> ，第二行（原来的第四行）有 <span class="arithmatex">\(2\)</span> 个 <span class="arithmatex">\(1\)</span> ，第三行（原来的第五行）有 <span class="arithmatex">\(2\)</span> 个 <span class="arithmatex">\(1\)</span> 。选择第一行（原来的第二行），将它删除，并将所有 <span class="arithmatex">\(1\)</span> 所在的列打上标记；
    $$
    \begin{pmatrix}
      \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}1 \\
      \color{Red}1 &amp; 0 &amp; \color{Red}1 &amp; \color{Red}0 \\
      \color{Red}0 &amp; 1 &amp; \color{Red}0 &amp; \color{Red}1
    \end{pmatrix}
    $$
5.  选择所有被标记的列，将它们删除，并将这些列中含 <span class="arithmatex">\(1\)</span> 的行打上标记；
    $$
    \begin{pmatrix}
      \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}1 \\
      \color{Blue}1 &amp; \color{Red}0 &amp; \color{Blue}1 &amp; \color{Blue}0 \\
      \color{Blue}0 &amp; \color{Red}1 &amp; \color{Blue}0 &amp; \color{Blue}1
    \end{pmatrix}
    $$
6.  选择所有被标记的行，将它们删除；
    $$
    \begin{pmatrix}
      \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}1 \\
      \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}0 \\
      \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1
    \end{pmatrix}
    $$
    于是我们得到了一个空矩阵。但是上次删除的行 "1 0 1 1" 不是全 <span class="arithmatex">\(1\)</span> 的，说明选择有误；
    $$
    \begin{pmatrix}
    \end{pmatrix}
    $$
7.  回溯到步骤 <span class="arithmatex">\(4\)</span> ，我们考虑选择第二行（原来的第四行），将它删除，并将所有 <span class="arithmatex">\(1\)</span> 所在的列打上标记；
    $$
    \begin{pmatrix}
      \color{Red}1 &amp; 0 &amp; \color{Red}1 &amp; 1 \\
      \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}0 \\
      \color{Red}0 &amp; 1 &amp; \color{Red}0 &amp; 1
    \end{pmatrix}
    $$
8.  选择所有被标记的列，将它们删除，并将这些列中含 <span class="arithmatex">\(1\)</span> 的行打上标记；
    $$
    \begin{pmatrix}
      \color{Blue}1 &amp; \color{Red}0 &amp; \color{Blue}1 &amp; \color{Red}1 \\
      \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}0 \\
      \color{Blue}0 &amp; 1 &amp; \color{Blue}0 &amp; 1
    \end{pmatrix}
    $$
9.  选择所有被标记的行，将它们删除；
    $$
    \begin{pmatrix}
      \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}1 \\
      \color{Blue}1 &amp; \color{Blue}0 &amp; \color{Blue}1 &amp; \color{Blue}0 \\
      \color{Blue}0 &amp; 1 &amp; \color{Blue}0 &amp; 1
      \end{pmatrix}
    $$
    于是我们得到了这样的一个矩阵：
    $$
    \begin{pmatrix}
      1 &amp; 1
    \end{pmatrix}
    $$
10. 此时第一行（原来的第五行）有 <span class="arithmatex">\(2\)</span> 个 <span class="arithmatex">\(1\)</span> ，将它们全部删除，我们得到了一个空矩阵：
    $$
    \begin{pmatrix}
    \end{pmatrix}
    $$
11. 上一次删除的时候，删除的是全 <span class="arithmatex">\(1\)</span> 的行，因此成功，算法结束。答案即为我们删除的三行： <span class="arithmatex">\(1, 4, 5\)</span> 。</p>
<p><strong>强烈建议自己模拟一遍矩阵删除、还原与回溯的过程后再接着阅读下文。</strong> </p>
<p>我们可以概括出 X 算法的过程：</p>
<ol>
<li>对于现在的矩阵 <span class="arithmatex">\(M\)</span> ，选择并标记一列 <span class="arithmatex">\(r\)</span> ，将 <span class="arithmatex">\(r\)</span> 添加至 <span class="arithmatex">\(S\)</span> 中；</li>
<li>如果尝试了所有的 <span class="arithmatex">\(r\)</span> 却无解，则算法结束，输出无解。</li>
<li>标记与 <span class="arithmatex">\(r\)</span> 相关的行 <span class="arithmatex">\(r_i\)</span> 和 <span class="arithmatex">\(c_i\)</span> ；</li>
<li>删除所有标记的行和列，得到新矩阵 <span class="arithmatex">\(M'\)</span> ；</li>
<li>
<p>如果 <span class="arithmatex">\(M'\)</span> 为空，且 <span class="arithmatex">\(r\)</span> 为全 <span class="arithmatex">\(1\)</span> 的，则算法结束，输出被删除的行组成的集合 <span class="arithmatex">\(S\)</span> ；</p>
<p>如果 <span class="arithmatex">\(M'\)</span> 为空，且 <span class="arithmatex">\(r\)</span> 不为全 <span class="arithmatex">\(1\)</span> 的，则恢复与 <span class="arithmatex">\(r\)</span> 相关的行 <span class="arithmatex">\(r_i\)</span> 以及列 <span class="arithmatex">\(c_i\)</span> ，跳转至步骤 <span class="arithmatex">\(1\)</span> ；</p>
<p>如果 <span class="arithmatex">\(M'\)</span> 不为空，则跳转至步骤 <span class="arithmatex">\(1\)</span> 。</p>
</li>
</ol>
<p>不难看出，X 算法需要大量的“删除行”、“删除列”和“恢复行”、“恢复列”的操作。</p>
<p>Donald E. Knuth 想到了用双向十字链表来维护这些操作。</p>
<p>而在双向十字链表上不断跳跃的过程被形象地比喻成“跳跃”，因此被用来优化 X 算法的双向十字链表也被称为“Dancing Links”。</p>
<h2 id="dancing-links-x"><strong>Dancing Links 优化的 X 算法</strong><a class="headerlink" href="#dancing-links-x" title="Permanent link">&para;</a></h2>
<h3 id="_4"><strong>预编译命令</strong><a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#define IT(i, A, x) for (i = A[x]; i != x; i = A[i])</span>
</code></pre></div>
</td></tr></table>

<h3 id="_5">****定义****<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>既然是双向十字链表，那么一定是有四个指针域的：一个指上方的元素，一个指下方的元素，一个指左边的元素，一个指右边的元素。而每个元素 <span class="arithmatex">\(i\)</span> 在整个双向十字链表系中都对应着一个格子，因此还要表示 <span class="arithmatex">\(i\)</span> 所在的列和所在的这样：</p>
<p><img alt="dlx-1" src="4-1-1.png" /></p>
<p>是不是非常简单？</p>
<p>而其实大型双向链表其实是长这样的：</p>
<p><img alt="dlx-2" src="4-1-2.png" /></p>
<p>每一行都有一个行首指示，每一列都有一个列指示。</p>
<p>行首指示为 <code>first[]</code> ，列指示是我们虚拟出的 <span class="arithmatex">\(c + 1\)</span> 个结点。</p>
<p>同时，每一列都有一个 <code>siz[]</code> 表示这一列的元素个数。</p>
<p>特殊地， <span class="arithmatex">\(0\)</span> 号结点无右结点等价于这个 Dancing Links 为空。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MS</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">first</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">siz</span><span class="p">[</span><span class="n">MS</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">L</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">MS</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">col</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="n">MS</span><span class="p">];</span>
</code></pre></div>
</td></tr></table>

<h3 id="remove"><strong>remove 操作</strong><a class="headerlink" href="#remove" title="Permanent link">&para;</a></h3>
<p><span class="arithmatex">\(\textrm{remove(c)}\)</span> 表示在 Dancing Links 中删除第 <span class="arithmatex">\(c\)</span> 列以及与其相关的行和列。</p>
<p>我们先将 <span class="arithmatex">\(c\)</span> 删除，此时：</p>
<ol>
<li><span class="arithmatex">\(c\)</span> 左侧的结点的右结点应为 <span class="arithmatex">\(c\)</span> 的右结点；</li>
<li><span class="arithmatex">\(c\)</span> 右侧的结点的左结点应为 <span class="arithmatex">\(c\)</span> 的左结点。</li>
</ol>
<p>即 <code>L[R[c]] = L[c], R[L[c]] = R[c];</code> 。</p>
<p><img alt="dlx-3.png" src="4-2-1.png" /></p>
<p>然后我们要顺着这一列往下走，把走过的每一行都删掉。</p>
<p>如何删掉每一行呢？枚举当前行的指针 <span class="arithmatex">\(j\)</span> ，此时：</p>
<ol>
<li><span class="arithmatex">\(j\)</span> 上方的结点的下结点应为 <span class="arithmatex">\(j\)</span> 的下结点；</li>
<li><span class="arithmatex">\(j\)</span> 下方的结点的上结点应为 <span class="arithmatex">\(j\)</span> 的上结点。</li>
</ol>
<p>注意要修改每一列的元素个数。</p>
<p>即 <code>U[D[j]] = U[j], D[U[j]] = D[j], --siz[col[j]];</code> 。</p>
<p><img alt="dlx-4.png" src="4-2-2.png" /></p>
<p>因此 <span class="arithmatex">\(\textrm{remove(c)}\)</span> 的代码实现就非常简单了：</p>
<p>其中第一个 <code>IT(i, D, c)</code> 等价于 <code>for(i = D[c]; i != c; i = D[i])</code> ，即在顺着这一列从上往下遍历；</p>
<p>第二个 <code>IT(j, R, i)</code> 等价于 <code>for(j = R[i]; j != i; j = R[j])</code> ，即在顺着这一行从左往右遍历。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
  <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
  <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="o">--</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h3 id="recover"><strong>recover 操作</strong><a class="headerlink" href="#recover" title="Permanent link">&para;</a></h3>
<p><span class="arithmatex">\(\textrm{recover(c)}\)</span> 表示在 Dancing Links 中还原第 <span class="arithmatex">\(c\)</span> 列以及与其相关的行和列。</p>
<p><span class="arithmatex">\(\textrm{recover(c)}\)</span> 即 <span class="arithmatex">\(\textrm{remove(c)}\)</span> 的逆操作，在这里就不多赘述了。</p>
<p><strong>值得注意的是，</strong>  <span class="arithmatex">\(\textrm{recover(c)}\)</span>  <strong>的所有操作的顺序与</strong>  <span class="arithmatex">\(\textrm{remove(c)}\)</span>  <strong>的操作恰好相反。</strong> </p>
<p>在这里给出 <span class="arithmatex">\(\textrm{recover(c)}\)</span> 的代码实现：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">recover</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
  <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
  <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h3 id="build"><strong>build 操作</strong><a class="headerlink" href="#build" title="Permanent link">&para;</a></h3>
<p><span class="arithmatex">\(\textrm{build(r, c)}\)</span> 表示新建一个大小为 <span class="arithmatex">\(r \times c\)</span> ，即有 <span class="arithmatex">\(r\)</span> 行， <span class="arithmatex">\(c\)</span> 列的 Dancing Links。</p>
<p>我们新建 <span class="arithmatex">\(c + 1\)</span> 个结点，为列指示。</p>
<p>第 <span class="arithmatex">\(i\)</span> 个点的左结点为 <span class="arithmatex">\(i - 1\)</span> ，右结点为 <span class="arithmatex">\(i + 1\)</span> ，上结点为 <span class="arithmatex">\(i\)</span> ，下结点为 <span class="arithmatex">\(i\)</span> 。</p>
<p>特殊地， <span class="arithmatex">\(0\)</span> 结点的左结点为 <span class="arithmatex">\(c\)</span> ， <span class="arithmatex">\(c\)</span> 结点的右结点为 <span class="arithmatex">\(0\)</span> 。</p>
<p>于是我们得到了一条链：</p>
<p><img alt="dlx-5.png" src="4-4.png" /></p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">first</span><span class="p">));</span>
  <span class="n">memset</span><span class="p">(</span><span class="n">siz</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">siz</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>这样就初始化了一个 Dancing Links。</p>
<h3 id="insert"><strong>insert 操作</strong><a class="headerlink" href="#insert" title="Permanent link">&para;</a></h3>
<p><span class="arithmatex">\(\textrm{insert(r, c)}\)</span> 表示在第 <span class="arithmatex">\(r\)</span> 行，第 <span class="arithmatex">\(c\)</span> 列插入一个结点。</p>
<p>我们分两种情况来操作：</p>
<ol>
<li>如果第 <span class="arithmatex">\(r\)</span> 行没有元素，那么直接插入一个元素，并使 <span class="arithmatex">\(first(r)\)</span> 指向这个元素；</li>
<li>如果第 <span class="arithmatex">\(r\)</span> 行有元素，那么将这个新元素 <strong>用一种奇异的方式</strong> 与 <span class="arithmatex">\(c\)</span> 和 <span class="arithmatex">\(first(r)\)</span> 连接起来。</li>
</ol>
<p>对于情况 1，我们可以通过 <code>first[r] = L[idx] = R[idx] = idx;</code> 来实现；</p>
<p>对于情况 2，（我们称这个新元素为 <span class="arithmatex">\(idx\)</span> ）：</p>
<ul>
<li>
<p>我们把 <span class="arithmatex">\(idx\)</span> 插入到 <span class="arithmatex">\(c\)</span> 的正下方，此时：</p>
<ol>
<li><span class="arithmatex">\(idx\)</span> 下方的结点为原来 <span class="arithmatex">\(c\)</span> 的下结点；</li>
<li><span class="arithmatex">\(idx\)</span> 下方的结点（即原来 <span class="arithmatex">\(c\)</span> 的下结点）的上结点为 <span class="arithmatex">\(idx\)</span> ;</li>
<li><span class="arithmatex">\(idx\)</span> 的上结点为 <span class="arithmatex">\(c\)</span> ；</li>
<li><span class="arithmatex">\(c\)</span> 的下结点为 <span class="arithmatex">\(idx\)</span> 。</li>
</ol>
<p>注意记录 <span class="arithmatex">\(idx\)</span> 的所在列和所在行，以及更新这一列的元素个数。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">col</span><span class="p">[</span><span class="o">++</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
<span class="n">U</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

<p><strong>强烈建议读者完全掌握这几步的顺序后再继续阅读本文。</strong> </p>
</li>
<li>
<p>我们把 <span class="arithmatex">\(idx\)</span> 插入到 <span class="arithmatex">\(first(r)\)</span> 的正右方，此时：</p>
<ol>
<li><span class="arithmatex">\(idx\)</span> 右侧的结点为原来 <span class="arithmatex">\(first(r)\)</span> 的右结点；</li>
<li>原来 <span class="arithmatex">\(first(r)\)</span> 右侧的结点的左结点为 <span class="arithmatex">\(idx\)</span> ；</li>
<li><span class="arithmatex">\(idx\)</span> 的左结点为 <span class="arithmatex">\(first(r)\)</span> ；</li>
<li><span class="arithmatex">\(first(r)\)</span> 的右结点为 <span class="arithmatex">\(idx\)</span> 。</li>
</ol>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">L</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]];</span>
<span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">,</span> <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>

<p><strong>强烈建议读者完全掌握这几步的顺序后再继续阅读本文。</strong> </p>
</li>
</ul>
<p>对于 <span class="arithmatex">\(\textrm{insert(r, c)}\)</span> 这个操作，我们可以画图来辅助理解：</p>
<p><img alt="dlx-6.png" src="4-5.png" /></p>
<p>留心曲线箭头的方向。</p>
<p>在这里给出 <span class="arithmatex">\(\textrm{insert(r, c)}\)</span> 的代码：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">row</span><span class="p">[</span><span class="o">++</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">col</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
  <span class="n">U</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
    <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">L</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]];</span>
    <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h3 id="dance"><strong>dance 操作</strong><a class="headerlink" href="#dance" title="Permanent link">&para;</a></h3>
<p><span class="arithmatex">\(\textrm{dance()}\)</span> 即为递归地删除以及还原各个行列的过程。</p>
<ol>
<li>如果 <span class="arithmatex">\(0\)</span> 号结点没有右结点，那么矩阵为空，记录答案并返回；</li>
<li>选择列元素个数最少的一列，并删掉这一列；</li>
<li>遍历这一列所有有 <span class="arithmatex">\(1\)</span> 的行，枚举它是否被选择；</li>
<li>递归调用 <span class="arithmatex">\(\textrm{dance()}\)</span> ，如果可行，则返回；如果不可行，则恢复被选择的行；</li>
<li>如果无解，则返回；</li>
</ol>
<p>在这里给出 <span class="arithmatex">\(\textrm{dance()}\)</span> 的代码实现：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">bool</span> <span class="nf">dance</span><span class="p">(</span><span class="kt">int</span> <span class="n">dep</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="n">dep</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">siz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
  <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">stk</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">remove</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dance</span><span class="p">(</span><span class="n">dep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">recover</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="n">recover</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>其中 <code>stk[]</code> 用来记录答案。</p>
<p>注意我们每次优先选择列元素个数最少的一列进行删除，这样能保证程序具有一定的启发性，使搜索树分支最少。</p>
<h2 id="_6"><strong>模板</strong><a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p><a href="https://www.luogu.com.cn/problem/P4929">「模板」舞蹈链（DLX）</a> </p>
<details class="note"><summary>模板代码</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<span class="cp">#define ll long long</span>
<span class="cp">#define rgi register int</span>
<span class="cp">#define rgl register ll</span>
<span class="cp">#define il inline</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ans</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">first</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">siz</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">stk</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="k">struct</span> <span class="n">DLXNODE</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">lc</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">dn</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">il</span> <span class="kt">int</span> <span class="nf">read</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">rgi</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ch</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">()))</span> <span class="n">f</span> <span class="o">|=</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ch</span> <span class="o">^</span> <span class="mi">48</span><span class="p">),</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">f</span> <span class="o">?</span> <span class="o">-</span><span class="nl">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="n">DLX</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MAXSIZE</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
<span class="cp">#define IT(i, A, x) for (i = A[x]; i != x; i = A[i])</span>
  <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tot</span><span class="p">,</span> <span class="n">first</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">siz</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">L</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">col</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>
  <span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tot</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">first</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">siz</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">siz</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">col</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
    <span class="n">D</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
      <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">R</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]],</span> <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
      <span class="n">L</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rgi</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="o">--</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">recover</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rgi</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
    <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">bool</span> <span class="nf">dance</span><span class="p">(</span><span class="kt">int</span> <span class="n">dep</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
      <span class="n">ans</span> <span class="o">=</span> <span class="n">dep</span><span class="p">;</span>
      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">rgi</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">siz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">stk</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">remove</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">dance</span><span class="p">(</span><span class="n">dep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">recover</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">recover</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">#undef IT</span>
<span class="p">}</span> <span class="n">solver</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">read</span><span class="p">(),</span> <span class="n">m</span> <span class="o">=</span> <span class="n">read</span><span class="p">();</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">read</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">dance</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ans</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ans</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span> <span class="n">stk</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
  <span class="k">else</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;No Solution!&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

</details>
<h2 id="_7"><strong>时间复杂度分析</strong><a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>DLX 的时间复杂度是 <strong>指数级</strong> 的，它递归及回溯的次数与矩阵中 <span class="arithmatex">\(1\)</span> 的个数有关，与矩阵的 <span class="arithmatex">\(r, c\)</span> 等参数无关。</p>
<p>因此理论复杂度大概在 <span class="arithmatex">\(O(c^n)\)</span> 左右，其中 <span class="arithmatex">\(c\)</span> 为某个非常接近于 <span class="arithmatex">\(1\)</span> 的常数， <span class="arithmatex">\(n\)</span> 为矩阵中 <span class="arithmatex">\(1\)</span> 的个数。</p>
<p>但实际情况下 DLX 表现良好，一般能解决大部分的问题。</p>
<h2 id="_8"><strong>如何建模</strong><a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>DLX 的难点，不全在于链表的建立，而在于建模。</p>
<p><strong>请确保已经完全掌握 DLX 模板后再继续阅读本文。</strong> </p>
<p>我们每拿到一个题，应该考虑行和列所表示的意义：</p>
<ul>
<li>
<p>行表示 <em>决策</em>，因为每行对应着一个集合，也就对应着选/不选；</p>
</li>
<li>
<p>列表示 <em>状态</em>，因为第 <span class="arithmatex">\(i\)</span> 列对应着某个条件 <span class="arithmatex">\(P_i\)</span> 。</p>
</li>
</ul>
<p>对于某一行而言，由于不同的列的值不尽相同，我们 <strong>由不同的状态，定义了一个决策</strong> 。</p>
<h3 id="_9">**例题一 <a href="https://www.luogu.com.cn/problem/P1784">数独</a> **<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<details class="note"><summary>解题思路</summary><p>先考虑决策是什么。</p>
<p>在这一题中，每一个决策可以用形如 <span class="arithmatex">\((r, c, w)\)</span> 的有序三元组表示。</p>
<p>注意到“宫”并不是决策的参数，因为它 <strong>可以被每个确定的 <span class="arithmatex">\((r, c)\)</span> 表示</strong> 。</p>
<p>因此有 <span class="arithmatex">\(9 \times 9 \times 9 = 729\)</span> 行。</p>
<p>再考虑状态是什么。</p>
<p>我们思考一下 <span class="arithmatex">\((r, c, w)\)</span> 这个决将会造成什么影响。记 <span class="arithmatex">\((r, c)\)</span> 所在的宫为 <span class="arithmatex">\(b\)</span> 。</p>
<ol>
<li>第 <span class="arithmatex">\(r\)</span> 行用了一个 <span class="arithmatex">\(w\)</span> （用 <span class="arithmatex">\(9 \times 9 = 81\)</span> 列表示）；</li>
<li>第 <span class="arithmatex">\(c\)</span> 列用了一个 <span class="arithmatex">\(w\)</span> （用 <span class="arithmatex">\(9 \times 9 = 81\)</span> 列表示）；</li>
<li>第 <span class="arithmatex">\(b\)</span> 宫用了一个 <span class="arithmatex">\(w\)</span> （用 <span class="arithmatex">\(9 \times 9 = 81\)</span> 列表示）；</li>
<li><span class="arithmatex">\((r, c)\)</span> 中填入了一个数（用 <span class="arithmatex">\(9 \times 9 = 81\)</span> 列表示）。</li>
</ol>
<p>因此有 <span class="arithmatex">\(81 \times 4 = 324\)</span> 列，共 <span class="arithmatex">\(729 \times 4 = 2916\)</span> 个 <span class="arithmatex">\(1\)</span> 。</p>
<p>至此，我们成功地将 <span class="arithmatex">\(9 \times 9\)</span> 的数独问题转化成了一个 **有 <span class="arithmatex">\(729\)</span> 行， <span class="arithmatex">\(324\)</span> 列，共 <span class="arithmatex">\(2916\)</span> 个 <span class="arithmatex">\(1\)</span> ** 的精确覆盖问题。</p>
</details>
<details class="note"><summary>参考代码</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<span class="cp">#define LL long long</span>
<span class="cp">#define rgi register int</span>
<span class="cp">#define il inline</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
<span class="cp">#define JUDGE 0</span>
<span class="cp">#define DEBUG 0</span>
<span class="kt">int</span> <span class="n">ans</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="n">stk</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="n">il</span> <span class="kt">int</span> <span class="nf">read</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">rgi</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ch</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">()))</span> <span class="n">f</span> <span class="o">|=</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ch</span> <span class="o">^</span> <span class="mi">48</span><span class="p">),</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">f</span> <span class="o">?</span> <span class="o">-</span><span class="nl">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="n">DLX</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MAXSIZE</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
<span class="cp">#define IT(i, A, x) for (i = A[x]; i != x; i = A[i])</span>
  <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tot</span><span class="p">,</span> <span class="n">first</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">siz</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">L</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">col</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>
  <span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tot</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">first</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">siz</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">siz</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">col</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
    <span class="n">D</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
      <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">R</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]],</span> <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
      <span class="n">L</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rgi</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="o">--</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">recover</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rgi</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
    <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">bool</span> <span class="nf">dance</span><span class="p">(</span><span class="kt">int</span> <span class="n">dep</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rgi</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dep</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">stk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">stk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">%</span> <span class="mi">9</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">stk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">9</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">siz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">stk</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">remove</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">dance</span><span class="p">(</span><span class="n">dep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">recover</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">recover</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="n">solver</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">GetId</span><span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">room</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">dy</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">GetId</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>            <span class="c1">// task 1</span>
  <span class="kt">int</span> <span class="n">f2</span> <span class="o">=</span> <span class="mi">81</span> <span class="o">+</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>       <span class="c1">// task 2</span>
  <span class="kt">int</span> <span class="n">f3</span> <span class="o">=</span> <span class="mi">81</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">room</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>  <span class="c1">// task 3</span>
  <span class="kt">int</span> <span class="n">f4</span> <span class="o">=</span> <span class="mi">81</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">col</span><span class="p">;</span>   <span class="c1">// task 4</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">f1</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">f2</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">f3</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">f4</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="cp">#if JUDGE</span>
  <span class="n">freopen</span><span class="p">(</span><span class="s">&quot;.in&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
  <span class="n">freopen</span><span class="p">(</span><span class="s">&quot;.out&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="n">stdout</span><span class="p">);</span>
<span class="cp">#endif</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="mi">729</span><span class="p">,</span> <span class="mi">324</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">read</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
        <span class="n">Insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">dance</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">,</span> <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">,</span> <span class="n">putchar</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">))</span> <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

</details>
<h3 id="_10">**例题二 <a href="https://www.luogu.com.cn/problem/P1074">靶形数独</a> **<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<details class="note"><summary>解题思路</summary><p>这一题与 <a href="https://www.luogu.com.cn/problem/P1784">数独</a> 的模型构建 <strong>一模一样</strong> ，主要区别在于答案的更新。</p>
<p>这一题可以开一个权值数组，每次找到一组数独的解时，</p>
<p>每个位置上的数乘上对应的权值计入答案即可。</p>
</details>
<details class="note"><summary>参考代码</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<span class="cp">#define LL long long</span>
<span class="cp">#define il inline</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">oo</span> <span class="o">=</span> <span class="mh">0x3f3f3f3f</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">e</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>
                 <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>
                 <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>
                 <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">};</span>
<span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="o">-</span><span class="n">oo</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="n">stk</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
<span class="n">il</span> <span class="kt">int</span> <span class="nf">read</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ch</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">()))</span> <span class="n">f</span> <span class="o">|=</span> <span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39;-&#39;</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ch</span> <span class="o">^</span> <span class="mi">48</span><span class="p">),</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">getchar</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">f</span> <span class="o">?</span> <span class="o">-</span><span class="nl">x</span> <span class="p">:</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">GetWeight</span><span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">num</span> <span class="o">*</span> <span class="n">e</span><span class="p">[(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)];</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="n">DLX</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MAXSIZE</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
<span class="cp">#define IT(i, A, x) for (i = A[x]; i != x; i = A[i])</span>
  <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tot</span><span class="p">,</span> <span class="n">first</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">siz</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">L</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">col</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="n">MAXSIZE</span> <span class="o">+</span> <span class="mi">10</span><span class="p">];</span>
  <span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tot</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">first</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">siz</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">siz</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">col</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
    <span class="n">D</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
      <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">R</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]],</span> <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
      <span class="n">L</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="o">--</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">recover</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
    <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">dance</span><span class="p">(</span><span class="kt">int</span> <span class="n">dep</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
      <span class="kt">int</span> <span class="n">cur_ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dep</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">cur_row</span> <span class="o">=</span> <span class="p">(</span><span class="n">stk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">cur_col</span> <span class="o">=</span> <span class="p">(</span><span class="n">stk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">9</span> <span class="o">%</span> <span class="mi">9</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">cur_num</span> <span class="o">=</span> <span class="p">(</span><span class="n">stk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">9</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">cur_ans</span> <span class="o">+=</span> <span class="n">GetWeight</span><span class="p">(</span><span class="n">cur_row</span><span class="p">,</span> <span class="n">cur_col</span><span class="p">,</span> <span class="n">cur_num</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">ans</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">cur_ans</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">siz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">stk</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">remove</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
      <span class="n">dance</span><span class="p">(</span><span class="n">dep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">recover</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">recover</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="n">solver</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">GetId</span><span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">Insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>    <span class="c1">// r</span>
  <span class="kt">int</span> <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>    <span class="c1">// c</span>
  <span class="kt">int</span> <span class="n">room</span> <span class="o">=</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">dy</span><span class="p">;</span>  <span class="c1">// room</span>
  <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">GetId</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">num</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>            <span class="c1">// task 1</span>
  <span class="kt">int</span> <span class="n">f2</span> <span class="o">=</span> <span class="mi">81</span> <span class="o">+</span> <span class="p">(</span><span class="n">col</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>       <span class="c1">// task 2</span>
  <span class="kt">int</span> <span class="n">f3</span> <span class="o">=</span> <span class="mi">81</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">room</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>  <span class="c1">// task 3</span>
  <span class="kt">int</span> <span class="n">f4</span> <span class="o">=</span> <span class="mi">81</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span> <span class="o">+</span> <span class="n">col</span><span class="p">;</span>   <span class="c1">// task 4</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">f1</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">f2</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">f3</span><span class="p">);</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">f4</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="mi">729</span><span class="p">,</span> <span class="mi">324</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">read</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="o">++</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="k">continue</span><span class="p">;</span>
        <span class="n">Insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">dance</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">ans</span> <span class="o">==</span> <span class="o">-</span><span class="n">oo</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ans</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

</details>
<h3 id="noi2005">**例题三 <a href="https://www.luogu.com.cn/problem/P4205">「NOI2005」智慧珠游戏</a> **<a class="headerlink" href="#noi2005" title="Permanent link">&para;</a></h3>
<details class="note"><summary>解题思路</summary><p>定义：题中给我们的智慧珠的形态，称为这个智慧珠的 <em>标准形态</em>。</p>
<p>显然，我们可以通过改变两个参数 <span class="arithmatex">\(d\)</span> （表示顺时针旋转 <span class="arithmatex">\(90^{\circ}\)</span> 的次数）和 <span class="arithmatex">\(f\)</span> （是否水平翻转）来改变这个智慧珠的形态。</p>
<p>仍然，我们先考虑决策是什么。</p>
<p>在这一题中，每一个决策可以用形如 <span class="arithmatex">\((v, d, f, i)\)</span> 的有序五元组表示。</p>
<p>表示第 <span class="arithmatex">\(i\)</span> 个智慧珠的*标准形态*的左上角的位置，序号为 <span class="arithmatex">\(v\)</span> ，经过了 <span class="arithmatex">\(d\)</span> 次顺时针转 <span class="arithmatex">\(90^{\circ}\)</span> 。</p>
<p>巧合的是，我们可以令 <span class="arithmatex">\(f = 1\)</span> 时不水平翻转， <span class="arithmatex">\(f = -1\)</span> 时水平翻转，从而达到简化代码的目的。</p>
<p>因此有 <span class="arithmatex">\(55 \times 4 \times 2 \times 12 = 5280\)</span> 行。</p>
<p>需要注意的是，因为一些不合法的填充，如 <span class="arithmatex">\((1, 0, 1, 4)\)</span> ，</p>
<p>所以 <strong>在实际操作中，空的智慧珠棋盘也只需要建出 <span class="arithmatex">\(2730\)</span> 行。</strong> </p>
<p>再考虑状态是什么。</p>
<p>这一题的状态比较简单。</p>
<p>我们思考一下， <span class="arithmatex">\((v, d, f, i)\)</span> 这个决策会造成什么影响。</p>
<ol>
<li>
<p>某些格子被占了（用 <span class="arithmatex">\(55\)</span> 列表示）；</p>
</li>
<li>
<p>第 <span class="arithmatex">\(i\)</span> 个智慧珠被用了（用 <span class="arithmatex">\(12\)</span> 列表示）。</p>
</li>
</ol>
<p>因此有 <span class="arithmatex">\(55 + 12 = 67\)</span> 列，共 <span class="arithmatex">\(5280 \times (5 + 1) = 31680\)</span> 个 <span class="arithmatex">\(1\)</span> 。</p>
<p>至此，我们成功地将智慧珠游戏转化成了一个 **有 <span class="arithmatex">\(5280\)</span> 行， <span class="arithmatex">\(67\)</span> 列，共 <span class="arithmatex">\(31680\)</span> 个 <span class="arithmatex">\(1\)</span> ** 的精确覆盖问题。</p>
</details>
<details class="note"><summary>参考代码</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<span class="cp">#define LL long long</span>
<span class="kt">int</span> <span class="n">numcol</span><span class="p">,</span> <span class="n">numrow</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">dfn</span><span class="p">[</span><span class="mi">3000</span><span class="p">],</span> <span class="n">tx</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nxt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">num</span><span class="p">[</span><span class="mi">50</span><span class="p">][</span><span class="mi">50</span><span class="p">],</span> <span class="n">vis</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
<span class="kt">char</span> <span class="n">ans</span><span class="p">[</span><span class="mi">50</span><span class="p">][</span><span class="mi">50</span><span class="p">];</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">table</span><span class="p">[</span><span class="mi">12</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// directions of shapes</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}},</span>                   <span class="c1">// A</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">}},</span>           <span class="c1">// B</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">}},</span>           <span class="c1">// C</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">}},</span>           <span class="c1">// D</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">}},</span>   <span class="c1">// E</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">}},</span>   <span class="c1">// F</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}},</span>   <span class="c1">// G</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">}},</span>   <span class="c1">// H</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">}},</span>   <span class="c1">// I</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">}},</span>  <span class="c1">// J</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">}},</span>   <span class="c1">// K</span>
    <span class="p">{{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">}},</span>   <span class="c1">// L</span>
<span class="p">};</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">len</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">};</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">getx</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>
                    <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span>
                    <span class="mi">9</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span>
                    <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span>
                    <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span>
                    <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">14</span><span class="p">};</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">gety</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>
                    <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>
                    <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>
                    <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>
                    <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">9</span><span class="p">};</span>
<span class="k">struct</span> <span class="n">DLX</span> <span class="p">{</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">MS</span> <span class="o">=</span> <span class="mf">1e5</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
<span class="cp">#define IT(i, A, x) for (i = A[x]; i != x; i = A[i])</span>
  <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">tot</span><span class="p">,</span> <span class="n">first</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">siz</span><span class="p">[</span><span class="n">MS</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">L</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">MS</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">col</span><span class="p">[</span><span class="n">MS</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="n">MS</span><span class="p">];</span>
  <span class="kt">void</span> <span class="nf">build</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tot</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">first</span><span class="p">));</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">siz</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">siz</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">col</span><span class="p">[</span><span class="o">++</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
    <span class="n">D</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">,</span> <span class="n">U</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">D</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
      <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>
    <span class="k">else</span>
      <span class="n">R</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]],</span> <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">,</span> <span class="n">L</span><span class="p">[</span><span class="n">tot</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
      <span class="n">R</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">r</span><span class="p">]]</span> <span class="o">=</span> <span class="n">tot</span><span class="p">;</span>  <span class="c1">// !</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rgi</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">];</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="o">--</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">recover</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">rgi</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">U</span><span class="p">[</span><span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]];</span>
    <span class="n">L</span><span class="p">[</span><span class="n">R</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="n">L</span><span class="p">[</span><span class="n">c</span><span class="p">]]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">bool</span> <span class="nf">dance</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">rgi</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">R</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">siz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">siz</span><span class="p">[</span><span class="n">c</span><span class="p">])</span> <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="n">IT</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">55</span><span class="p">)</span> <span class="n">ans</span><span class="p">[</span><span class="n">getx</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]]][</span><span class="n">gety</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">dfn</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span>
      <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">remove</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">55</span><span class="p">)</span> <span class="n">ans</span><span class="p">[</span><span class="n">getx</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]]][</span><span class="n">gety</span><span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]]]</span> <span class="o">=</span> <span class="n">dfn</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">+</span> <span class="sc">&#39;A&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">dance</span><span class="p">())</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">IT</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="n">recover</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="n">recover</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="cp">#undef IT</span>
<span class="p">}</span> <span class="n">solver</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;.&#39;</span><span class="p">)</span> <span class="n">vis</span><span class="p">[</span><span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="sc">&#39;A&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">num</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="n">numcol</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">solver</span><span class="p">.</span><span class="n">build</span><span class="p">(</span><span class="mi">2730</span><span class="p">,</span> <span class="n">numcol</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>
  <span class="cm">/*******build*******/</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">op</span><span class="p">;</span> <span class="n">id</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">;</span> <span class="o">++</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// every block</span>
    <span class="k">for</span> <span class="p">(</span><span class="o">++</span><span class="n">numcol</span><span class="p">,</span> <span class="n">op</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">op</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">op</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">dx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">dx</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">dx</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">dy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">dy</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">;</span> <span class="o">++</span><span class="n">dy</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">tx</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="o">++</span><span class="n">tx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
              <span class="kt">bool</span> <span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
              <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">[</span><span class="n">id</span><span class="p">];</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">nxt</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">=</span> <span class="n">tx</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">dx</span><span class="p">]</span> <span class="o">*</span> <span class="n">table</span><span class="p">[</span><span class="n">id</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
                <span class="n">nxt</span><span class="p">[</span><span class="n">op</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tx</span><span class="p">[</span><span class="n">op</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">dy</span><span class="p">]</span> <span class="o">*</span> <span class="n">table</span><span class="p">[</span><span class="n">id</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">id</span><span class="p">])</span> <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">nxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">nxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">!=</span> <span class="n">id</span> <span class="o">+</span> <span class="sc">&#39;A&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                  <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">nxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">nxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">!=</span> <span class="sc">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>
                  <span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                  <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
              <span class="p">}</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
              <span class="n">dfn</span><span class="p">[</span><span class="o">++</span><span class="n">numrow</span><span class="p">]</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
              <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">numrow</span><span class="p">,</span> <span class="n">numcol</span><span class="p">);</span>
              <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">[</span><span class="n">id</span><span class="p">];</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">nxt</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">=</span> <span class="n">tx</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">dx</span><span class="p">]</span> <span class="o">*</span> <span class="n">table</span><span class="p">[</span><span class="n">id</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
                <span class="n">nxt</span><span class="p">[</span><span class="n">op</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tx</span><span class="p">[</span><span class="n">op</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[</span><span class="n">dy</span><span class="p">]</span> <span class="o">*</span> <span class="n">table</span><span class="p">[</span><span class="n">id</span><span class="p">][</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
                <span class="n">solver</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">numrow</span><span class="p">,</span> <span class="n">num</span><span class="p">[</span><span class="n">nxt</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">nxt</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="cm">/********end********/</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">solver</span><span class="p">.</span><span class="n">dance</span><span class="p">())</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;No solution&quot;</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">,</span> <span class="n">puts</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">rgi</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">i</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="n">putchar</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

</details>
<h2 id="_11"><strong>练习</strong><a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<ol>
<li><a href="https://www.spoj.com/problems/SUDOKU/">SUDOKU - Sudoku</a> </li>
<li><a href="https://vjudge.net/contest/65998#overview">「kuangbin 带你飞」专题三 Dancing Links</a> </li>
</ol>
<h2 id="_12"><strong>总结</strong><a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<p>DLX 能用来解决精确覆盖问题，适当地建立起模型后能解决一些搜索题。</p>
<h2 id="_13"><strong>参考资料</strong><a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<ul>
<li>[1]英雄哪里出来 的 <a href="https://blog.csdn.net/whereisherofrom/article/details/79220897">《夜深人静写算法（九）- Dancing Links X（跳舞链）》</a> </li>
<li>[2]万仓一黍 的 <a href="https://www.cnblogs.com/grenet/p/3145800.html">《跳跃的舞者，舞蹈链（Dancing Links）算法——求解精确覆盖问题》</a> </li>
<li>[3]zhangjianjunab 的 <a href="https://blog.csdn.net/zhangjianjunab/article/details/83688681">《DLX 算法一览》</a> </li>
<li>[4]静听风吟。的 <a href="https://www.cnblogs.com/aininot260/p/9629926.html">《搜索：DLX 算法》</a> </li>
<li>[5]刘汝佳，陈锋 的 <a href="https://item.jd.com/11111050.html">《算法竞赛入门经典-训练指南》</a> </li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../ac-automaton/" title="AC 自动机" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                AC 自动机
              </div>
            </div>
          </a>
        
        
          <a href="../pam/" title="回文树" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                回文树
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &#169 2018 - 2020 <a href="https://github.com/LeverImmy/">Clever_Jimmy</a>
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.c3dc8c49.min.js"></script>
      <script src="../../../assets/javascripts/bundle.f9edbbd5.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="../../../javascripts/config.js"></script>
      
    
  </body>
</html>